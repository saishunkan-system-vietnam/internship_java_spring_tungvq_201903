<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssv.template.data.mapper.ProjectMapper">
	<insert id="insertProject" parameterType="Project" >
		
        INSERT INTO Project (NAMEPROJECT, STARTDATE, ENDDATE, BUILDING_ID) VALUES (#{nameproject},#{startdate},#{enddate},#{buildingId});
    </insert>
 
    <update id="updateProject" parameterType="Project">
        UPDATE Project SET NAMEPROJECT = #{nameproject} WHERE ID = #{id};
        UPDATE Project SET STARTDATE = #{startdate} WHERE ID = #{id};
        UPDATE Project SET ENDDATE = #{enddate} WHERE ID = #{id};
     	UPDATE Project SET BUILDING_ID = #{buildingId} WHERE ID = #{id};
    </update>
     
    <delete id="deleteProjectById" parameterType="int">
        DELETE from Project WHERE ID = #{id};
    </delete>
    
    <select id="selectProjectById" parameterType="int">
    	SELECT * FROM Project WHERE ID = #{id};
    </select>
    
    <resultMap id = "result" type = "Project"></resultMap>
    <select id="findByNameContaining" parameterType="string" resultMap="result">
  			SELECT * FROM Project 
  			left join building on (Project.building_id = building.id)
  			<where>
	  			<if test="namebuilding != null and namebuilding != ''">
	  				name like '%'||#{namebuilding}||'%' 
	  			</if>
	  			<if test="nameproject != null and nameproject != ''">
	  				AND nameproject like '%'||#{nameproject}||'%'
	  			</if>
	  			<if test="startsearch != null and startsearch != ''">
					AND to_char(startdate, 'YYYY-MM-DD') > #{startsearch} 
				</if>
				<if test="endsearch != null and endsearch != ''">
					AND #{endsearch} > to_char(enddate, 'YYYY-MM-DD')
				</if>
			</where>
	</select>
    
	<resultMap id = "result1" type = "Project"></resultMap>
    <select id="findByNameContaining1" parameterType="string" resultMap="result"> 
    	SELECT * FROM Project WHERE NAMEPROJECT like '%'||#{nameproject}||'%'
    </select>
</mapper>
